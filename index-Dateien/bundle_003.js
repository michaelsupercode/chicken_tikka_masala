"use strict";var foundation=foundation||{};foundation.adPlayer=foundation.adPlayer||{};foundation.adPlayer.bitmovin=(()=>{var w=Object.create;var u=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var S=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),O=(a,e)=>{for(var t in e)u(a,t,{get:e[t],enumerable:!0})},T=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of M(e))!_.call(a,i)&&i!==t&&u(a,i,{get:()=>e[i],enumerable:!(r=D(e,i))||r.enumerable});return a};var o=(a,e,t)=>(t=a!=null?w(k(a)):{},T(e||!a||!a.__esModule?u(t,"default",{value:a,enumerable:!0}):t,a)),I=a=>T(u({},"__esModule",{value:!0}),a);var b=S(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.ErrorCodes=void 0;p.ErrorCodes={FALLBACK_DRM_ERROR:1e4,AUTHENTICATION_FAILED:11e3,TOKEN_PROBLEM:11100,TOKEN_INVALID:11110,TOKEN_MISSING:11120,PERMISSION_PROBLEM:11200,PAY_PERMISSION_MISSING:11210,DOWNLOAD_PERMISSION_MISSING:11220,RIGHTS_RESTRICTIONS_NOT_MET:12e3,GEOBLOCKING:12100,USING_OF_AN_ANONYM_PROXY_OR_VPN:12110,LOCATION_NOT_ALLOWED:12120,HDCP_REQUIREMENT_NOT_FULFILLED:12300,DEVICE_IS_DENYLISTED_BY_GOOGLE_FOR_WIDEVINE:12400,LICENSE:13e3,LICENSE_EXPIRED:13100,LICENSE_NOT_PERSISTABLE:13200,LICENSE_ENVIRONMENT:13300,INVALID_MISSING_FAIRPLAY_CERTIFICATE_URL:13310,INVALID_FAIRPLAY_CERTIFICATE_DATA:13320,CONTENT:2e4,MEDIA_FORMAT_UNSUPPORTED:20100,AVAILABILITY:21e3,CONTENT_NOT_AVAILABLE:21100,SOURCE_MATERIAL_NOT_AVAILABLE:21110,CONTENT_NOT_DOWNLOADABLE:21200,CLIENT:3e4,NO_PLAYABLE_TRACK_LEFT:30100,NETWORK_PROBLEM:31e3,BAD_INTERNET_CONNECTION:31110,PLATFORM:32e3,UNSUPPORTED_DRM:32100,NO_DRM_OPTION_AVAILABLE_ANY_MORE:32110,DRM_NOT_FULLY_IMPLEMENTED:32120,UNSUPPORTED_STREAM_TECH:32200,NO_MANIFESTS_PLAYABLE:32210,MANIFEST_NOT_SUPPORTED:32220,MAX_CONCURRENT_STREAMS_REACHED:33100,PLAYERCONFIG_PROBLEM:34e3,ADBLOCKER_DETECTED:34100,VIDEOSOURCES_CONFIG:34200,NO_MANIFEST_IN_CONFIG:34210,MISSING_PLAYER_ELEMENT_OR_ID:34300,FAULTY_ADVERTISING_ISLAND_CONFIGURED:34510,PLAYER_ALREADY_DESTROYED:35100,FAULTY_SETUP_FOR_NON_LINEAR_ADVERTISING:35210,MISSING_USER_INTERACTION:35310,OPERATION_ABORTED:35400,OPERATION_ABORTED_PLAY:35410,OPERATION_ABORTED_LOAD:35420,OPERATION_ABORTED_POWER_SAVING:35430,OPERATION_ABORTED_VIDEO_REMOVED:35440,DEPENDENCY:4e4,V3_UNAVAILABLE:41100,ENTITLEMENT_UNAVAILABLE:41200,DB_UNAVAILABLE:41300,GOOGLE_WIDEVINE_UNAVAILABLE:41400,MANIFEST_API_UNAVAILABLE:41500,OTHER_UNAVAILABLE:41600,ATV_SCHEDULER_UNAVAILABLE:41700,STUS_UNAVAILABLE:41800,ATV_SCHEDULER_REQUEST_FAILED_HTTP_STATUS_CODE_4XX:42700,ATV_SCHEDULER_REQUEST_FAILED_HTTP_STATUS_CODE_5XX:42710,STUS_RETURNS_4XX_ERROR:42800,ATV_SCHEDULER_REQUEST_TIMED_OUT:43700,INTERNAL_PLAYER_ERROR:5e4,UNEXPECTED_EVENT:51e3,PLAYER_DEPENDENCIES_COULD_NOT_BE_LOADED:52110,PLAYER_DEPENDENCY_MISSING:52120,PLAYER_DEPENDENCY_INVALID:52130,ERROR_NOT_TREATED:59e3}});var n=S(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.ErrorCodes=void 0;var N=b();Object.defineProperty(h,"ErrorCodes",{enumerable:!0,get:function(){return N.ErrorCodes}})});var $={};O($,{createAdPlayer:()=>K});var f={AdStarted:"advertising:AdStarted",AdStopped:"advertising:AdStopped",AdSlotStarted:"advertising:AdSlotStarted",AdSlotStopped:"advertising:AdSlotStopped",AdSlotCompleted:"advertising:AdSlotCompleted"};var l={GrunerUndJahr:"grunerundjahr",RTLPlusWatch:"rtlplusmpawatch",RTLPlusRadio:"rtlplusmparadio",RTLPlusAudiobook:"rtlplusmpaaudiobook",RTLPlusPodcast:"rtlplusmpapodcast",SuperRTLToggo:"superrtltoggo",MediaHub:"mediahub",RTLDigitalNews:"rtldigitalnews",CorporateSites:"corporatesites"},Z={[l.RTLPlusWatch]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[l.RTLPlusRadio]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[l.RTLPlusAudiobook]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[l.RTLPlusPodcast]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[l.RTLDigitalNews]:{NTV:"ntv",Capital:"capital",Geo:"geo",RTL:"rtl",Sport:"sport",Stern:"stern",Wetter:"wetter"},[l.CorporateSites]:{BusinessPortal:"businessportal",Crime:"crime",GeoTV:"geotv",JournalistenSchule:"journalistenschule",Living:"living",Nitro:"nitro",Passion:"passion",RTLSuper:"rtlsuper",RTLUp:"rtlup",SchlagerLiebe:"schlagerliebe",VOX:"vox"},[l.GrunerUndJahr]:{BabyClub:"babyclub",Brigitte:"brigitte",Eltern:"eltern",EssenUndTrinken:"essenundtrinken",Gala:"gala",Geolino:"geolino",LivingAtHome:"livingathome",SchoenerWohnen:"schoenerwohnen",Urbia:"urbia",VIP:"vip",Vorname:"vorname"}};var A={None:0,Error:10,Warn:20,Info:30,Debug:40,Trace:50};var v={PlayerCreated:"player:PlayerCreated",MediaStarted:"player:MediaStarted",ContentStart:"player:ContentStart",ContentEnd:"player:ContentEnd",SessionStart:"player:SessionStart",SessionEnd:"player:SessionEnd",Destroy:"player:Destroy",HDCPFallback:"player:HDCPFallback",CueEnter:"player:CueEnter",CueExit:"player:CueExit",Error:"player:Error",Muted:"player:Muted",Unmuted:"player:Unmuted",Play:"player:Play",Paused:"player:Paused",PlaybackSpeedChanged:"player:PlaybackSpeedChanged",Playing:"player:Playing",Ready:"player:Ready",Seek:"player:Seek",Seeked:"player:Seeked",StallStarted:"player:StallStarted",StallEnded:"player:StallEnded",TimeChanged:"player:TimeChanged",VolumeChanged:"player:VolumeChanged",AudioTrackSelected:"player:AudioTrackSelected",TextTrackSelected:"player:SubtitlesSelected",SubtitlesSelected:"player:SubtitlesSelected",MetadataUpdated:"player:MetadataUpdated"};var U=o(n());var E=o(n());var s=a=>{var t;if(!a){let r=new Error("Cannot return a logger for an empty namespace");throw Object.assign(r,{code:E.ErrorCodes.INTERNAL_PLAYER_ERROR}),r}let e=(t=window.foundation)==null?void 0:t.logger;if(!e){let r=new Error("Logger on the window object wasn't initialized yet when getLogger() was called");throw Object.assign(r,{code:E.ErrorCodes.PLAYER_DEPENDENCY_MISSING}),r}return e.getLogger(a)},oe=A.Warn;var B=o(n());var H=o(n());var Y=o(n());var W=o(n());var G=o(n());var j=o(n());var q=o(n()),fe={...v,UpdateMetaData:"player:UpdateMetaData",TimedMetadata:"player:TimedMetadata",MetricAdded:"player:MetricAdded",PlayerLoaded:"player:PlayerLoaded",MediaLoad:"player:MediaLoad",MediaLoaded:"player:MediaLoaded",Destroyed:"player:Destroyed",Metadata:"player:Metadata",PlaybackFinished:"player:PlaybackFinished",ContentReady:"player:ContentReady",SourceLoaded:"player:SourceLoaded",SourceUnloaded:"player:SourceUnloaded",StallingFix:"player:StallingFix",MediaAdaptation:"player:MediaAdaptation",AutoplaySuccessful:"player:AutoplaySuccessful",TrackChanged:"player:TrackChanged",KeySystemSelected:"player:KeySystemSelected"};var y=(a=>(a.NORMAL="normal",a.FULLSCREEN="fullscreen",a))(y||{}),Se={...f,AdSlotsCreated:"advertising:AdSlotsCreated",InitAdSlot:"advertising:InitAdSlot",AdSlotReady:"advertising:AdSlotReady",PauseAd:"advertising:PauseAd",ResumeAd:"advertising:ResumeAd",SkipAd:"advertising:SkipAd",StartAdSlot:"advertising:StartAdSlot",StopAdSlot:"advertising:StopAdSlot",OpenClickThrough:"advertising:OpenClickThrough",HomadActivation:"advertising:HomadActivation",HomadPenalty:"advertising:HomadPenalty",AdError:"advertising:AdError",AdQuartileReached:"advertising:AdQuartileReached"};var g={ended:"playbackfinished",error:"error",loadeddata:"sourceloaded",timeupdate:"timechanged",playerPlay:"play",playerPause:"paused",volumeChanged:"volumechanged",muted:"muted",unmuted:"unmuted"},z="3.2",m=class{constructor(e,t){this.log=s("adPlayer.bitmovin.BitmovinAdPlayer");this.PLAYER_EVENT_MAP=g;this.playerAdapter=e,this.eventListenerCache=[],this.getPlayerDelegate=t}handshakeVersion(){return z}onEvent(){}async load(e){var r;await this.disposeAdPlayer();let t={isLinear:!0,uiConfig:{requestsUi:!0},data:{},clickThroughUrlOpened:()=>{},duration:0,height:0,width:0,mediaFileUrl:e};try{this.log.debug("Request a new ad player for ad",t);let i=await((r=this.adPlaybackApi)==null?void 0:r.requestPlayer());return this.adPlayer=i,i?(this.log.debug("apply event listeners with the new AdPlayer",this.adPlayer,this.eventListenerCache.slice(0)),this.eventListenerCache=this.eventListenerCache.filter(d=>d.event!=="ended"),this.eventListenerCache.forEach(d=>d.bindHandler(i)),this.log.debug("load source",t),await i.load(t),Promise.resolve()):(this.log.debug("Could not create ad player for ad",t),Promise.reject())}catch(i){return this.log.debug("failed to load source.",t,i),Promise.reject()}}cacheEventListener(e,t){this.eventListenerCache.push({event:e,bindHandler:r=>{this.addEventListener(e,t,r)},unbindHandler:()=>{this.removeEventListener()}})}addEventListener(e,t,r){let i=r!=null?r:this.adPlayer;if(!i){this.cacheEventListener(e,t);return}let d=c=>{try{t(c)}catch(C){this.log.debug("Facade listener failed",C)}};try{e==="volumeChanged"&&(i.on(g.muted,d),i.on(g.unmuted,d));let c=g[e];if(!c){this.log.debug(`Mapping for ${e} does not exist`);return}i.on(c,d)}catch(c){this.log.debug("Facade add listener failed",c)}}removeEventListener(){}async lockContent(){var r;if(!((r=this.playerAdapter)!=null&&r.isPlayerAvailable()))return;let e=await this.getPlayerDelegate();if(!e)return this.log.warn("AdvertisingModule playerDelegate not set. Cancel ad loading."),Promise.reject("playerDelegate not set");if(!await this.getOrCreateAdPlaybackApi(e))return this.log.warn("AdvertisingModule playbackAPI not set. Cancel ad loading."),Promise.reject("playbackAPI not set")}getCurrentContentSource(){var e;return(e=this.playerAdapter)==null?void 0:e.getMediaURL()}getPlayerSize(){return{boundingRect:this.getPlayerBoundingRect(),viewMode:this.getViewMode()}}getPlayerBoundingRect(){var e,t,r;return(r=(t=(e=this.playerAdapter)==null?void 0:e.getVideoElement())==null?void 0:t.getBoundingClientRect())!=null?r:{top:0,left:0,right:0,bottom:0,width:0,height:0}}getViewportSize(){return{boundingRect:{top:0,left:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight},viewMode:this.getViewMode()}}getViewMode(){var e;return(e=this.playerAdapter)!=null&&e.isFullscreen()?y.FULLSCREEN:y.NORMAL}async releaseContent(){var e;if(!this.adPlaybackApi){if(this.log.error("Can not reset current content source: adPlaybackApi is not set"),!((e=this.playerAdapter)!=null&&e.isPlayerAvailable()))return;await this.playerAdapter.play();return}try{this.log.debug("Cleanup facade on release content"),await this.cleanup()}catch(t){return Promise.reject(t)}}destroy(){this.playerAdapter=void 0,this.adPlayer=void 0,this.adPlaybackApi=void 0}getError(){}getEnvironmentVars(){}getCurrentTime(){var t;if(!this.playerAdapter||!this.adPlayer)return 0;let e=0;try{e=(t=this.adPlayer.currentTime)!=null?t:0}catch(r){this.log.debug("Facade getCurrentTime failed",r)}return e}getDuration(){let e=this.getPlayerElement();return e?e.duration:0}getVideoElement(){return this.getPlayerElement()}getPlayerElement(){var e;return(e=this.playerAdapter)==null?void 0:e.getVideoElement()}getVolume(){return this.playerAdapter?this.playerAdapter.getVolume():0}setVolume(e){return this.playerAdapter&&this.playerAdapter.setVolume(e),Promise.resolve()}isMuted(){let e=!1;if(!this.adPlayer)return e;try{e=this.adPlayer.muted}catch(t){this.log.debug("Facade isMuted failed",t)}return e}mute(){if(this.adPlayer)try{this.adPlayer.muted=!0}catch(e){this.log.debug("Facade mute failed",e)}return Promise.resolve()}unmute(){if(this.adPlayer)try{this.adPlayer.muted=!1}catch(e){this.log.debug("Facade unmute failed",e)}return Promise.resolve()}isPaused(){var t;let e=!1;if(!this.adPlayer)return e;try{e=(t=this.adPlayer.paused)!=null?t:!1}catch(r){this.log.debug("Facade isPaused failed",r)}return e}pause(){if(this.adPlayer)try{this.adPlayer.pause()}catch(e){this.log.debug("Facade pause failed",e)}return Promise.resolve()}async play(){var e;if(!(!this.adPlayer||!this.playerAdapter)&&((e=this.playerAdapter.getVideoElement())==null?void 0:e.readyState)!==0)try{await this.adPlayer.play()}catch(t){this.log.debug("Facade play failed",t)}}seek(e){return this.log.info("Seeking is not supported by the Bitmovin.AdPlayer module."),Promise.resolve()}async cleanup(){this.cleanupEventListener(),await this.disposeAdPlayer(),await this.finishAdBreak()}cleanupEventListener(){this.log.debug("Cleanup event listeners"),this.eventListenerCache.forEach(e=>e.unbindHandler()),this.eventListenerCache=[]}async disposeAdPlayer(){if(this.log.debug("Dispose adPlayer",this.adPlayer),!this.adPlayer){this.log.debug("Dispose ad player not required");return}try{let e=await this.adPlayer.done();this.log.debug("adPlayer.done() returned ",e)}catch(e){this.log.debug("Dispose ad player failed",e)}this.adPlayer=void 0}async finishAdBreak(){if(this.log.debug("Finished ad break",this.adPlaybackApi),!this.adPlaybackApi){this.log.debug("Finished ad break not needed");return}try{await this.adPlaybackApi.done(),this.log.debug("finished ad break and restored main content")}catch(e){this.log.debug("Failed to finish ad break",e)}this.adPlaybackApi=void 0}async getOrCreateAdPlaybackApi(e){if(this.adPlaybackApi)return this.adPlaybackApi;try{return this.adPlaybackApi=await e.requestAdPlayback({id:this.getPseudoRandomString(),scheduleTime:0}),this.adPlaybackApi}catch(t){return this.log.error("Could not request adPlaybackApi",t),Promise.reject(t)}}getPseudoRandomString(){return(Math.random()+1).toString(36)}};function K(a){let e=a.getPlayerAdapter(),t=e.advertisingModule.getPlayerDelegate.bind(e.advertisingModule),r=new m(e,t);return e.advertisingModule.setPlayer(a),r}return I($);})();
