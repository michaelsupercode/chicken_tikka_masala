"use strict";var foundation=foundation||{};foundation.plugin=foundation.plugin||{};foundation.plugin.visibility=(()=>{var G=Object.create;var f=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var g=(s,i)=>()=>(i||s((i={exports:{}}).exports,i),i.exports),$=(s,i)=>{for(var e in i)f(s,e,{get:i[e],enumerable:!0})},D=(s,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let r of j(i))!z.call(s,r)&&r!==e&&f(s,r,{get:()=>i[r],enumerable:!(t=q(i,r))||t.enumerable});return s};var c=(s,i,e)=>(e=s!=null?G(K(s)):{},D(i||!s||!s.__esModule?f(e,"default",{value:s,enumerable:!0}):e,s)),X=s=>D(f({},"__esModule",{value:!0}),s);var I=g(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.ErrorCodes=void 0;E.ErrorCodes={FALLBACK_DRM_ERROR:1e4,AUTHENTICATION_FAILED:11e3,TOKEN_PROBLEM:11100,TOKEN_INVALID:11110,TOKEN_MISSING:11120,PERMISSION_PROBLEM:11200,PAY_PERMISSION_MISSING:11210,DOWNLOAD_PERMISSION_MISSING:11220,RIGHTS_RESTRICTIONS_NOT_MET:12e3,GEOBLOCKING:12100,USING_OF_AN_ANONYM_PROXY_OR_VPN:12110,LOCATION_NOT_ALLOWED:12120,HDCP_REQUIREMENT_NOT_FULFILLED:12300,DEVICE_IS_DENYLISTED_BY_GOOGLE_FOR_WIDEVINE:12400,LICENSE:13e3,LICENSE_EXPIRED:13100,LICENSE_NOT_PERSISTABLE:13200,LICENSE_ENVIRONMENT:13300,INVALID_MISSING_FAIRPLAY_CERTIFICATE_URL:13310,INVALID_FAIRPLAY_CERTIFICATE_DATA:13320,CONTENT:2e4,MEDIA_FORMAT_UNSUPPORTED:20100,AVAILABILITY:21e3,CONTENT_NOT_AVAILABLE:21100,SOURCE_MATERIAL_NOT_AVAILABLE:21110,CONTENT_NOT_DOWNLOADABLE:21200,CLIENT:3e4,NO_PLAYABLE_TRACK_LEFT:30100,NETWORK_PROBLEM:31e3,BAD_INTERNET_CONNECTION:31110,PLATFORM:32e3,UNSUPPORTED_DRM:32100,NO_DRM_OPTION_AVAILABLE_ANY_MORE:32110,DRM_NOT_FULLY_IMPLEMENTED:32120,UNSUPPORTED_STREAM_TECH:32200,NO_MANIFESTS_PLAYABLE:32210,MANIFEST_NOT_SUPPORTED:32220,MAX_CONCURRENT_STREAMS_REACHED:33100,PLAYERCONFIG_PROBLEM:34e3,ADBLOCKER_DETECTED:34100,VIDEOSOURCES_CONFIG:34200,NO_MANIFEST_IN_CONFIG:34210,MISSING_PLAYER_ELEMENT_OR_ID:34300,FAULTY_ADVERTISING_ISLAND_CONFIGURED:34510,PLAYER_ALREADY_DESTROYED:35100,FAULTY_SETUP_FOR_NON_LINEAR_ADVERTISING:35210,MISSING_USER_INTERACTION:35310,OPERATION_ABORTED:35400,OPERATION_ABORTED_PLAY:35410,OPERATION_ABORTED_LOAD:35420,OPERATION_ABORTED_POWER_SAVING:35430,OPERATION_ABORTED_VIDEO_REMOVED:35440,DEPENDENCY:4e4,V3_UNAVAILABLE:41100,ENTITLEMENT_UNAVAILABLE:41200,DB_UNAVAILABLE:41300,GOOGLE_WIDEVINE_UNAVAILABLE:41400,MANIFEST_API_UNAVAILABLE:41500,OTHER_UNAVAILABLE:41600,ATV_SCHEDULER_UNAVAILABLE:41700,STUS_UNAVAILABLE:41800,ATV_SCHEDULER_REQUEST_FAILED_HTTP_STATUS_CODE_4XX:42700,ATV_SCHEDULER_REQUEST_FAILED_HTTP_STATUS_CODE_5XX:42710,STUS_RETURNS_4XX_ERROR:42800,ATV_SCHEDULER_REQUEST_TIMED_OUT:43700,INTERNAL_PLAYER_ERROR:5e4,UNEXPECTED_EVENT:51e3,PLAYER_DEPENDENCIES_COULD_NOT_BE_LOADED:52110,PLAYER_DEPENDENCY_MISSING:52120,PLAYER_DEPENDENCY_INVALID:52130,ERROR_NOT_TREATED:59e3}});var u=g(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.ErrorCodes=void 0;var J=I();Object.defineProperty(T,"ErrorCodes",{enumerable:!0,get:function(){return J.ErrorCodes}})});var k=g((B,A)=>{(function(s){var i=-1,e={onVisible:function(t){var r=e.isSupported();if(!r||!e.hidden())return t(),r;var a=e.change(function(o,n){e.hidden()||(e.unbind(a),t())});return a},change:function(t){if(!e.isSupported())return!1;i+=1;var r=i;return e._callbacks[r]=t,e._listen(),r},unbind:function(t){delete e._callbacks[t]},afterPrerendering:function(t){var r=e.isSupported(),a="prerender";if(!r||a!=e.state())return t(),r;var o=e.change(function(n,l){a!=l&&(e.unbind(o),t())});return o},hidden:function(){return!!(e._doc.hidden||e._doc.webkitHidden)},state:function(){return e._doc.visibilityState||e._doc.webkitVisibilityState||"visible"},isSupported:function(){return e._doc.hidden!==void 0||e._doc.webkitHidden!==void 0},_doc:document||{},_callbacks:{},_change:function(t){var r=e.state();for(var a in e._callbacks)e._callbacks[a].call(e._doc,t,r)},_listen:function(){if(!e._init){var t="visibilitychange";e._doc.webkitVisibilityState&&(t="webkit"+t);var r=function(){e._change.apply(e,arguments)};e._doc.addEventListener?e._doc.addEventListener(t,r):e._doc.attachEvent(t,r),e._init=!0}}};typeof A!="undefined"&&A.exports?A.exports=e:s.Visibility=e})(B)});var U=g((at,b)=>{(function(s){var i=-1,e=function(t){return t.every=function(r,a,o){t._time(),o||(o=a,a=null),i+=1;var n=i;return t._timers[n]={visible:r,hidden:a,callback:o},t._run(n,!1),t.isSupported()&&t._listen(),n},t.stop=function(r){return t._timers[r]?(t._stop(r),delete t._timers[r],!0):!1},t._timers={},t._time=function(){t._timed||(t._timed=!0,t._wasHidden=t.hidden(),t.change(function(){t._stopRun(),t._wasHidden=t.hidden()}))},t._run=function(r,a){var o,n=t._timers[r];if(t.hidden()){if(n.hidden===null)return;o=n.hidden}else o=n.visible;var l=function(){n.last=new Date,n.callback.call(s)};if(a){var W=new Date,M=W-n.last;o>M?n.delay=setTimeout(function(){n.id=setInterval(l,o),l()},o-M):(n.id=setInterval(l,o),l())}else n.id=setInterval(l,o)},t._stop=function(r){var a=t._timers[r];clearInterval(a.id),clearTimeout(a.delay),delete a.id,delete a.delay},t._stopRun=function(r){var a=t.hidden(),o=t._wasHidden;if(a&&!o||!a&&o)for(var n in t._timers)t._stop(n),t._run(n,!a)},t};typeof b!="undefined"&&b.exports?b.exports=e(k()):e(s.Visibility||k())})(window)});var Y=g((nt,H)=>{H.exports=U()});var ce={};$(ce,{VisibilityPlugin:()=>R});var C={PreRoll:"PRE_ROLL",MidRoll:"MID_ROLL",PostRoll:"POST_ROLL",NonLinear:"NON_LINEAR"},w={AdStarted:"advertising:AdStarted",AdStopped:"advertising:AdStopped",AdSlotStarted:"advertising:AdSlotStarted",AdSlotStopped:"advertising:AdSlotStopped",AdSlotCompleted:"advertising:AdSlotCompleted"};var h={GrunerUndJahr:"grunerundjahr",RTLPlusWatch:"rtlplusmpawatch",RTLPlusRadio:"rtlplusmparadio",RTLPlusAudiobook:"rtlplusmpaaudiobook",RTLPlusPodcast:"rtlplusmpapodcast",SuperRTLToggo:"superrtltoggo",MediaHub:"mediahub",RTLDigitalNews:"rtldigitalnews",CorporateSites:"corporatesites"},ye={[h.RTLPlusWatch]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[h.RTLPlusRadio]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[h.RTLPlusAudiobook]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[h.RTLPlusPodcast]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[h.RTLDigitalNews]:{NTV:"ntv",Capital:"capital",Geo:"geo",RTL:"rtl",Sport:"sport",Stern:"stern",Wetter:"wetter"},[h.CorporateSites]:{BusinessPortal:"businessportal",Crime:"crime",GeoTV:"geotv",JournalistenSchule:"journalistenschule",Living:"living",Nitro:"nitro",Passion:"passion",RTLSuper:"rtlsuper",RTLUp:"rtlup",SchlagerLiebe:"schlagerliebe",VOX:"vox"},[h.GrunerUndJahr]:{BabyClub:"babyclub",Brigitte:"brigitte",Eltern:"eltern",EssenUndTrinken:"essenundtrinken",Gala:"gala",Geolino:"geolino",LivingAtHome:"livingathome",SchoenerWohnen:"schoenerwohnen",Urbia:"urbia",VIP:"vip",Vorname:"vorname"}};var _={None:0,Error:10,Warn:20,Info:30,Debug:40,Trace:50};var v={PlayerCreated:"player:PlayerCreated",MediaStarted:"player:MediaStarted",ContentStart:"player:ContentStart",ContentEnd:"player:ContentEnd",SessionStart:"player:SessionStart",SessionEnd:"player:SessionEnd",Destroy:"player:Destroy",HDCPFallback:"player:HDCPFallback",CueEnter:"player:CueEnter",CueExit:"player:CueExit",Error:"player:Error",Muted:"player:Muted",Unmuted:"player:Unmuted",Play:"player:Play",Paused:"player:Paused",PlaybackSpeedChanged:"player:PlaybackSpeedChanged",Playing:"player:Playing",Ready:"player:Ready",Seek:"player:Seek",Seeked:"player:Seeked",StallStarted:"player:StallStarted",StallEnded:"player:StallEnded",TimeChanged:"player:TimeChanged",VolumeChanged:"player:VolumeChanged",AudioTrackSelected:"player:AudioTrackSelected",TextTrackSelected:"player:SubtitlesSelected",SubtitlesSelected:"player:SubtitlesSelected",MetadataUpdated:"player:MetadataUpdated"};var te=c(u());var O=c(u());var d=s=>{var e;if(!s){let t=new Error("Cannot return a logger for an empty namespace");throw Object.assign(t,{code:O.ErrorCodes.INTERNAL_PLAYER_ERROR}),t}let i=(e=window.foundation)==null?void 0:e.logger;if(!i){let t=new Error("Logger on the window object wasn't initialized yet when getLogger() was called");throw Object.assign(t,{code:O.ErrorCodes.PLAYER_DEPENDENCY_MISSING}),t}return i.getLogger(s)},Ae=_.Warn;var re=c(u());var ie=c(u());var se=c(u());var ae=c(u());var ne=c(u());var oe=c(u());var de=c(u()),S={...v,UpdateMetaData:"player:UpdateMetaData",TimedMetadata:"player:TimedMetadata",MetricAdded:"player:MetricAdded",PlayerLoaded:"player:PlayerLoaded",MediaLoad:"player:MediaLoad",MediaLoaded:"player:MediaLoaded",Destroyed:"player:Destroyed",Metadata:"player:Metadata",PlaybackFinished:"player:PlaybackFinished",ContentReady:"player:ContentReady",SourceLoaded:"player:SourceLoaded",SourceUnloaded:"player:SourceUnloaded",StallingFix:"player:StallingFix",MediaAdaptation:"player:MediaAdaptation",AutoplaySuccessful:"player:AutoplaySuccessful",TrackChanged:"player:TrackChanged",KeySystemSelected:"player:KeySystemSelected"};var Ie={...w,AdSlotsCreated:"advertising:AdSlotsCreated",InitAdSlot:"advertising:InitAdSlot",AdSlotReady:"advertising:AdSlotReady",PauseAd:"advertising:PauseAd",ResumeAd:"advertising:ResumeAd",SkipAd:"advertising:SkipAd",StartAdSlot:"advertising:StartAdSlot",StopAdSlot:"advertising:StopAdSlot",OpenClickThrough:"advertising:OpenClickThrough",HomadActivation:"advertising:HomadActivation",HomadPenalty:"advertising:HomadPenalty",AdError:"advertising:AdError",AdQuartileReached:"advertising:AdQuartileReached"};var F=class{setPlayer(s){this.player=s}};var L=c(Y());var p={ViewportLeft:"visibility:ViewportLeft",ViewportEntered:"visibility:ViewportEntered",PageEntered:"visibility:PageEntered",PageLeft:"visibility:PageLeft"};var le={...v,UpdateMetaData:"player:UpdateMetaData",TimedMetadata:"player:TimedMetadata",MetricAdded:"player:MetricAdded",PlayerLoaded:"player:PlayerLoaded",MediaLoad:"player:MediaLoad",MediaLoaded:"player:MediaLoaded",Destroyed:"player:Destroyed",Metadata:"player:Metadata",PlaybackFinished:"player:PlaybackFinished",ContentReady:"player:ContentReady",SourceLoaded:"player:SourceLoaded",SourceUnloaded:"player:SourceUnloaded",StallingFix:"player:StallingFix",MediaAdaptation:"player:MediaAdaptation",AutoplaySuccessful:"player:AutoplaySuccessful",TrackChanged:"player:TrackChanged",KeySystemSelected:"player:KeySystemSelected"};var P=class extends Event{constructor(i,e={}){super(i),this.originalEvent=e.originalEvent}};var y=class extends P{constructor(i,e={}){super(i,e)}},m=class extends y{constructor(e,t){super(e,t);this.opts=t;this.playerVisible=t.playerVisible}};var R=class extends F{constructor(e){super();this.pluginConfig=e;this.log=d("plugin.advertising.visibility-plugin");this.playerIntersectionThreshold=.5;this.playerIntersectionRatio=1;this.pageVisibility="visible";this.adsPausedByVisibility=!1;this.contentPausedByVisibility=!1}getKey(){return"foundation.plugin.visibility"}getPlugin(){return this}shouldPauseAdsOnLeave(){var e,t;return(t=(e=this.pluginConfig)==null?void 0:e.pauseAds)!=null?t:!0}shouldPauseContentOnLeave(){var e,t;return(t=(e=this.pluginConfig)==null?void 0:e.pauseContent)!=null?t:!1}playerInitialized(){return this.player&&(this.player.addEventListener(S.Destroy,()=>{this.unbindVisibility()}),this.player.addEventListener(S.Playing,()=>{this.contentPausedByVisibility=!1,this.adsPausedByVisibility=!1}),this.player.addEventListener(p.ViewportLeft,()=>this.onPlayerLeftViewport()),this.player.addEventListener(p.ViewportEntered,e=>this.onPlayerEnteredViewport(e.playerVisible)),this.player.addEventListener(p.PageLeft,()=>this.onPageLeave()),this.player.addEventListener(p.PageEntered,e=>this.onPageEnter(e.playerVisible)),this.initVisibility()),Promise.resolve()}playerIsVisible(){return this.pageVisibility==="visible"&&this.playerIntersectionRatio>=this.playerIntersectionThreshold}initVisibility(){!this.player||this.visibilityListenerId||!(this.shouldPauseAdsOnLeave()||this.shouldPauseContentOnLeave())||(this.pageVisibility=L.default.hidden()?"hidden":"visible",this.player.addEventListener(S.TimeChanged,()=>{this.pageVisibility==="hidden"&&this.onPageLeave(),this.playerIntersectionRatio<this.playerIntersectionThreshold&&this.onPlayerLeftViewport()}),this.useVisibilityListener(),this.useIntersectionObserver())}useVisibilityListener(){this.visibilityListenerId=L.default.change((e,t)=>{var r,a;t==="hidden"?(this.pageVisibility="hidden",(r=this.player)==null||r.dispatchEvent(new y(p.PageLeft))):t==="visible"&&(this.pageVisibility="visible",(a=this.player)==null||a.dispatchEvent(new m(p.PageEntered,{playerVisible:this.playerIsVisible()})))})}useIntersectionObserver(){this.player&&"IntersectionObserver"in window&&(this.intersectionObserver=new IntersectionObserver(e=>{var a,o,n,l;let t=(o=(a=e[0])==null?void 0:a.intersectionRatio)!=null?o:1,r=t>=this.playerIntersectionThreshold;this.playerIntersectionRatio=t,r?(n=this.player)==null||n.dispatchEvent(new m(p.ViewportEntered,{playerVisible:this.playerIsVisible()})):(l=this.player)==null||l.dispatchEvent(new y(p.ViewportLeft))},{threshold:this.playerIntersectionThreshold}),this.intersectionObserver.observe(this.player.getPlayerElement()))}isLinearAdActive(){var r;let e=(r=this.player)==null?void 0:r.getAdvertisingAdapter();if(!(e!=null&&e.isAd()))return!1;let t=e.getCurrentAdSlot();return t?t.isActive()&&t.getType()!==C.NonLinear:!1}shouldPauseAds(){var e;return((e=this.player)==null?void 0:e.isPlaying())&&this.shouldPauseAdsOnLeave()&&this.isLinearAdActive()}shouldPauseContent(){var e;return((e=this.player)==null?void 0:e.isPlaying())&&this.shouldPauseContentOnLeave()&&!this.isLinearAdActive()}shouldResumeAds(){return this.shouldPauseAdsOnLeave()&&this.adsPausedByVisibility&&this.isLinearAdActive()}shouldResumeContent(){return this.shouldPauseContentOnLeave()&&this.contentPausedByVisibility&&!this.isLinearAdActive()}onPlayerLeftViewport(){var e,t;this.shouldPauseAds()&&((e=this.player)==null||e.pause(),this.adsPausedByVisibility=!0),this.shouldPauseContent()&&((t=this.player)==null||t.pause(),this.contentPausedByVisibility=!0)}onPlayerEnteredViewport(e){!this.player||!e||this.player.isPlaying()||(this.shouldResumeAds()?(this.adsPausedByVisibility=!1,this.player.play()):this.shouldResumeContent()&&(this.contentPausedByVisibility=!1,this.player.play()))}onPageLeave(){var e,t;this.shouldPauseAds()?((e=this.player)==null||e.pause(),this.adsPausedByVisibility=!0):this.shouldPauseContent()&&((t=this.player)==null||t.pause(),this.contentPausedByVisibility=!0)}onPageEnter(e){!this.player||!e||this.player.isPlaying()||(this.shouldResumeAds()?(this.player.play(),this.adsPausedByVisibility=!1):this.shouldResumeContent()&&(this.player.play(),this.contentPausedByVisibility=!1))}unbindVisibility(){this.visibilityListenerId&&typeof this.visibilityListenerId=="number"&&(L.default.unbind(this.visibilityListenerId),this.visibilityListenerId=void 0),this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=void 0)}};return X(ce);})();
