"use strict";var foundation=foundation||{};foundation.plugin=foundation.plugin||{};foundation.plugin.streamFallback=(()=>{var F=Object.create;var g=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var D=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),W=(e,t)=>{for(var r in t)g(e,r,{get:t[r],enumerable:!0})},_=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of B(t))!Y.call(e,s)&&s!==r&&g(e,s,{get:()=>t[s],enumerable:!(a=V(t,s))||a.enumerable});return e};var n=(e,t,r)=>(r=e!=null?F(H(e)):{},_(t||!e||!e.__esModule?g(r,"default",{value:e,enumerable:!0}):r,e)),G=e=>_(g({},"__esModule",{value:!0}),e);var M=D(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.ErrorCodes=void 0;m.ErrorCodes={FALLBACK_DRM_ERROR:1e4,AUTHENTICATION_FAILED:11e3,TOKEN_PROBLEM:11100,TOKEN_INVALID:11110,TOKEN_MISSING:11120,PERMISSION_PROBLEM:11200,PAY_PERMISSION_MISSING:11210,DOWNLOAD_PERMISSION_MISSING:11220,RIGHTS_RESTRICTIONS_NOT_MET:12e3,GEOBLOCKING:12100,USING_OF_AN_ANONYM_PROXY_OR_VPN:12110,LOCATION_NOT_ALLOWED:12120,HDCP_REQUIREMENT_NOT_FULFILLED:12300,DEVICE_IS_DENYLISTED_BY_GOOGLE_FOR_WIDEVINE:12400,LICENSE:13e3,LICENSE_EXPIRED:13100,LICENSE_NOT_PERSISTABLE:13200,LICENSE_ENVIRONMENT:13300,INVALID_MISSING_FAIRPLAY_CERTIFICATE_URL:13310,INVALID_FAIRPLAY_CERTIFICATE_DATA:13320,CONTENT:2e4,MEDIA_FORMAT_UNSUPPORTED:20100,AVAILABILITY:21e3,CONTENT_NOT_AVAILABLE:21100,SOURCE_MATERIAL_NOT_AVAILABLE:21110,CONTENT_NOT_DOWNLOADABLE:21200,CLIENT:3e4,NO_PLAYABLE_TRACK_LEFT:30100,NETWORK_PROBLEM:31e3,BAD_INTERNET_CONNECTION:31110,PLATFORM:32e3,UNSUPPORTED_DRM:32100,NO_DRM_OPTION_AVAILABLE_ANY_MORE:32110,DRM_NOT_FULLY_IMPLEMENTED:32120,UNSUPPORTED_STREAM_TECH:32200,NO_MANIFESTS_PLAYABLE:32210,MANIFEST_NOT_SUPPORTED:32220,MAX_CONCURRENT_STREAMS_REACHED:33100,PLAYERCONFIG_PROBLEM:34e3,ADBLOCKER_DETECTED:34100,VIDEOSOURCES_CONFIG:34200,NO_MANIFEST_IN_CONFIG:34210,MISSING_PLAYER_ELEMENT_OR_ID:34300,FAULTY_ADVERTISING_ISLAND_CONFIGURED:34510,PLAYER_ALREADY_DESTROYED:35100,FAULTY_SETUP_FOR_NON_LINEAR_ADVERTISING:35210,MISSING_USER_INTERACTION:35310,OPERATION_ABORTED:35400,OPERATION_ABORTED_PLAY:35410,OPERATION_ABORTED_LOAD:35420,OPERATION_ABORTED_POWER_SAVING:35430,OPERATION_ABORTED_VIDEO_REMOVED:35440,DEPENDENCY:4e4,V3_UNAVAILABLE:41100,ENTITLEMENT_UNAVAILABLE:41200,DB_UNAVAILABLE:41300,GOOGLE_WIDEVINE_UNAVAILABLE:41400,MANIFEST_API_UNAVAILABLE:41500,OTHER_UNAVAILABLE:41600,ATV_SCHEDULER_UNAVAILABLE:41700,STUS_UNAVAILABLE:41800,ATV_SCHEDULER_REQUEST_FAILED_HTTP_STATUS_CODE_4XX:42700,ATV_SCHEDULER_REQUEST_FAILED_HTTP_STATUS_CODE_5XX:42710,STUS_RETURNS_4XX_ERROR:42800,ATV_SCHEDULER_REQUEST_TIMED_OUT:43700,INTERNAL_PLAYER_ERROR:5e4,UNEXPECTED_EVENT:51e3,PLAYER_DEPENDENCIES_COULD_NOT_BE_LOADED:52110,PLAYER_DEPENDENCY_MISSING:52120,PLAYER_DEPENDENCY_INVALID:52130,ERROR_NOT_TREATED:59e3}});var o=D(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.ErrorCodes=void 0;var j=M();Object.defineProperty(f,"ErrorCodes",{enumerable:!0,get:function(){return j.ErrorCodes}})});var de={};W(de,{StreamFallbackPlugin:()=>A});var E={AdStarted:"advertising:AdStarted",AdStopped:"advertising:AdStopped",AdSlotStarted:"advertising:AdSlotStarted",AdSlotStopped:"advertising:AdSlotStopped",AdSlotCompleted:"advertising:AdSlotCompleted"};var c={GrunerUndJahr:"grunerundjahr",RTLPlusWatch:"rtlplusmpawatch",RTLPlusRadio:"rtlplusmparadio",RTLPlusAudiobook:"rtlplusmpaaudiobook",RTLPlusPodcast:"rtlplusmpapodcast",SuperRTLToggo:"superrtltoggo",MediaHub:"mediahub",RTLDigitalNews:"rtldigitalnews",CorporateSites:"corporatesites"},pe={[c.RTLPlusWatch]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[c.RTLPlusRadio]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[c.RTLPlusAudiobook]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[c.RTLPlusPodcast]:{Web:"web",Tizen:"tizen",LG:"lg",Magenta:"magenta",Sky:"sky",Chromecast:"chromecast"},[c.RTLDigitalNews]:{NTV:"ntv",Capital:"capital",Geo:"geo",RTL:"rtl",Sport:"sport",Stern:"stern",Wetter:"wetter"},[c.CorporateSites]:{BusinessPortal:"businessportal",Crime:"crime",GeoTV:"geotv",JournalistenSchule:"journalistenschule",Living:"living",Nitro:"nitro",Passion:"passion",RTLSuper:"rtlsuper",RTLUp:"rtlup",SchlagerLiebe:"schlagerliebe",VOX:"vox"},[c.GrunerUndJahr]:{BabyClub:"babyclub",Brigitte:"brigitte",Eltern:"eltern",EssenUndTrinken:"essenundtrinken",Gala:"gala",Geolino:"geolino",LivingAtHome:"livingathome",SchoenerWohnen:"schoenerwohnen",Urbia:"urbia",VIP:"vip",Vorname:"vorname"}};var T={None:0,Error:10,Warn:20,Info:30,Debug:40,Trace:50};var l={DashHD:"dashhd",DashSD:"dashsd",HlsHD:"hlsfairplayhd",HlsSD:"hlsfairplaysd",Progressive:"progressive"};var u={DASH:"DASH",HLS:"HLS",Progressive:"Progressive"},b={PlayerCreated:"player:PlayerCreated",MediaStarted:"player:MediaStarted",ContentStart:"player:ContentStart",ContentEnd:"player:ContentEnd",SessionStart:"player:SessionStart",SessionEnd:"player:SessionEnd",Destroy:"player:Destroy",HDCPFallback:"player:HDCPFallback",CueEnter:"player:CueEnter",CueExit:"player:CueExit",Error:"player:Error",Muted:"player:Muted",Unmuted:"player:Unmuted",Play:"player:Play",Paused:"player:Paused",PlaybackSpeedChanged:"player:PlaybackSpeedChanged",Playing:"player:Playing",Ready:"player:Ready",Seek:"player:Seek",Seeked:"player:Seeked",StallStarted:"player:StallStarted",StallEnded:"player:StallEnded",TimeChanged:"player:TimeChanged",VolumeChanged:"player:VolumeChanged",AudioTrackSelected:"player:AudioTrackSelected",TextTrackSelected:"player:SubtitlesSelected",SubtitlesSelected:"player:SubtitlesSelected",MetadataUpdated:"player:MetadataUpdated"};var te=n(o());var q=n(o());var Ae=T.Warn;var i=[];for(S=0;S<256;++S)i.push((S+256).toString(16).slice(1));var S;function k(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}var v,K=new Uint8Array(16);function L(){if(!v&&(v=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!v))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return v(K)}var z=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),P={randomUUID:z};function $(e,t,r){if(P.randomUUID&&!t&&!e)return P.randomUUID();e=e||{};var a=e.random||(e.rng||L)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,t){r=r||0;for(var s=0;s<16;++s)t[r+s]=a[s];return t}return k(a)}var R=$;var re=n(o());var ie=n(o());var ae=n(o());var I=n(o());var se=n(o());var oe=n(o());var ne=n(o()),p={...b,UpdateMetaData:"player:UpdateMetaData",TimedMetadata:"player:TimedMetadata",MetricAdded:"player:MetricAdded",PlayerLoaded:"player:PlayerLoaded",MediaLoad:"player:MediaLoad",MediaLoaded:"player:MediaLoaded",Destroyed:"player:Destroyed",Metadata:"player:Metadata",PlaybackFinished:"player:PlaybackFinished",ContentReady:"player:ContentReady",SourceLoaded:"player:SourceLoaded",SourceUnloaded:"player:SourceUnloaded",StallingFix:"player:StallingFix",MediaAdaptation:"player:MediaAdaptation",AutoplaySuccessful:"player:AutoplaySuccessful",TrackChanged:"player:TrackChanged",KeySystemSelected:"player:KeySystemSelected"},C=class extends Event{constructor(e,t={}){super(e),this.originalEvent=t.originalEvent}};var Z=class extends C{constructor(e,t){super(e,t),this.code=t.code,this.message=t.message,this.response=t.response,this.responseText=t.responseText,this.name=t.name,this.context=t.context,ee(this.response)&&(this.code=this.response.errorCode,this.message=this.response.error)}};function ee(e){return e!==null&&typeof e=="object"&&"origin"in e&&typeof e.origin=="string"&&"errorCode"in e&&typeof Number(e.errorCode)=="number"&&"error"in e&&typeof e.error=="string"}var Ye={...E,AdSlotsCreated:"advertising:AdSlotsCreated",InitAdSlot:"advertising:InitAdSlot",AdSlotReady:"advertising:AdSlotReady",PauseAd:"advertising:PauseAd",ResumeAd:"advertising:ResumeAd",SkipAd:"advertising:SkipAd",StartAdSlot:"advertising:StartAdSlot",StopAdSlot:"advertising:StopAdSlot",OpenClickThrough:"advertising:OpenClickThrough",HomadActivation:"advertising:HomadActivation",HomadPenalty:"advertising:HomadPenalty",AdError:"advertising:AdError",AdQuartileReached:"advertising:AdQuartileReached"};var N=class{constructor(e){var t,r;this.id=e.id,this.sessionId=e.sessionId,this.contentId=(t=e.contentId)!=null?t:R(),this.type=e.type,this.autoplayRequested=e.autoplayRequested,this.autoplaySupported=e.autoplaySupported,this.muted=e.muted,this.startTime=e.startTime,this.playbackSpeed=e.playbackSpeed,this.manifest=e.manifest,this.source=e.source,this.ovAudio=(r=e.ovAudio)!=null?r:!0,this.metadata=e.metadata||{}}get autoplay(){return this.autoplayRequested&&this.autoplaySupported}getStreamType(){if([l.HlsHD,l.HlsSD].includes(this.manifest.type))return u.HLS;if([l.DashHD,l.DashSD].includes(this.manifest.type))return u.DASH;if([l.Progressive].includes(this.manifest.type))return u.Progressive;throw new Z(p.Error,{message:`Could not determine stream type for manifest type "${this.manifest.type}"!`,code:I.ErrorCodes.VIDEOSOURCES_CONFIG,context:{manifest:this.manifest}})}};var x=class{setPlayer(e){this.player=e}};var w=n(o()),A=class extends x{constructor(){super(...arguments);this.isProcessingError=!1;this.nonFatalErrorCodes=new Set([w.ErrorCodes.ATV_SCHEDULER_UNAVAILABLE,w.ErrorCodes.ATV_SCHEDULER_REQUEST_FAILED_HTTP_STATUS_CODE_4XX])}getKey(){return"foundation.plugin.streamFallback"}playerInitialized(){return this.player&&(this.player.addEventListener(p.ContentReady,()=>this.onContentReady()),this.player.addEventListener(p.Error,r=>this.onError(r)),this.player.addEventListener(p.SessionStart,()=>this.onSessionStart())),Promise.resolve()}onContentReady(){var r;(r=this.player)==null||r.removeDestroyLock(this.getKey())}onSessionStart(){if(!this.player)return;let r=this.player.getPlaybackSession();if(!r)return;r.contentSources.length>1&&this.player.addDestroyLock(this.getKey())}isNonFatalError(r){return typeof r.code=="number"&&this.nonFatalErrorCodes.has(r.code)}async onError(r){if(!this.player||!this.player.hasDestroyLock(this.getKey())||this.isProcessingError||this.isNonFatalError(r))return;let a=this.player.getPlaybackSession(),s=this.player.getMedia();if(!a||!s)return;let U=a.contentSources.findIndex(h=>h.contentId===s.contentId),y=a.contentSources[U+1];if(y){this.isProcessingError=!0,y=new N({...y,autoplayRequested:!0}),await new Promise(h=>{setTimeout(h,50)}),this.player.removeDestroyLock(this.getKey());try{await this.player.unload(),this.player.dispatchEvent(new C(p.HDCPFallback)),await this.player.initializePlayout(y),this.isProcessingError=!1}catch(h){console.error(h),this.isProcessingError=!1}}}};return G(de);})();
